---
date: 2025-01-29
title: "å¤§æ¨¡å‹ + é˜¿é‡Œäº‘å®ä¾‹è¯Šæ–­: AI èµ‹èƒ½äº‘è¿ç»´çš„å®è·µä¸å¿ƒå¾—"
sidebarDepth: 1
category: llm
tags:
- llm

draft: false
---

# å¤§æ¨¡å‹ + é˜¿é‡Œäº‘å®ä¾‹è¯Šæ–­ï¼šAI èµ‹èƒ½äº‘è¿ç»´çš„å®è·µä¸å¿ƒå¾—

> æœ¬æ–‡ä»‹ç»æˆ‘ä»¬å¦‚ä½•åˆ©ç”¨å¤§æ¨¡å‹ï¼ˆLLMï¼‰ç»“åˆ MCP Server æŠ€æœ¯æ„å»ºæ™ºèƒ½åŒ–çš„é˜¿é‡Œäº‘å®ä¾‹è¯Šæ–­ç³»ç»Ÿã€‚æ–‡ç« é‡ç‚¹åˆ†äº«äº† MCP å·¥å…·è®¾è®¡çš„ä¸‰ä¸ªæ ¸å¿ƒåŸåˆ™ï¼šä½¿ç”¨ TOON æ ¼å¼ä¼˜åŒ– Token æ¶ˆè€—ã€é€šè¿‡æ˜¾å¼æ ‡æ³¨å•ä½æ¶ˆé™¤å¤§æ¨¡å‹å¹»è§‰ã€å¯¹æ—¶åºç›‘æ§æ•°æ®è¿›è¡Œé¢„è®¡ç®—ç»Ÿè®¡æ‘˜è¦ã€‚åŒæ—¶ä»‹ç»äº† Prompt å·¥ç¨‹å®è·µï¼Œé€šè¿‡æä¾›å®Œæ•´çš„è¾“å‡ºæ ¼å¼æ¨¡æ¿æ¥ä¿è¯è¯Šæ–­æŠ¥å‘Šçš„ä¸€è‡´æ€§ã€‚

## ä¸€ã€èƒŒæ™¯ä¸åŠ¨æœº

### ä¼ ç»Ÿäº‘è¿ç»´çš„ç—›ç‚¹

åœ¨æ—¥å¸¸äº‘èµ„æºè¿ç»´ä¸­ï¼Œè¿ç»´å·¥ç¨‹å¸ˆç»å¸¸é¢ä¸´è¿™äº›æŒ‘æˆ˜ï¼š

1. **ä¿¡æ¯åˆ†æ•£**ï¼šå®ä¾‹çŠ¶æ€ã€ç›‘æ§æ•°æ®ã€å®‰å…¨ç»„è§„åˆ™ã€ç£ç›˜ä¿¡æ¯åˆ†å¸ƒåœ¨ä¸åŒçš„æ§åˆ¶å°é¡µé¢
2. **æ’æŸ¥è€—æ—¶**ï¼šä¸€ä¸ªç®€å•çš„"å®ä¾‹è¿ä¸ä¸Š"é—®é¢˜ï¼Œå¯èƒ½éœ€è¦æ£€æŸ¥åå‡ ä¸ªç»´åº¦
3. **ç»éªŒä¾èµ–**ï¼šæ–°æ‰‹éš¾ä»¥å¿«é€Ÿå®šä½é—®é¢˜ï¼Œè€æ‰‹çš„ç»éªŒéš¾ä»¥æ²‰æ·€å’Œä¼ æ‰¿
4. **é‡å¤åŠ³åŠ¨**ï¼šç›¸ä¼¼é—®é¢˜åå¤æ’æŸ¥ï¼Œæ•ˆç‡ä½ä¸‹

### æˆ‘ä»¬çš„æ–¹æ¡ˆ

æˆ‘ä»¬å¸Œæœ›æ‰“é€ ä¸€ä¸ª**æç®€çš„è¯Šæ–­å…¥å£**ï¼šç”¨æˆ·åªéœ€è¦æä¾›ä¸€ä¸ªå®ä¾‹ IDï¼Œç³»ç»Ÿå°±èƒ½è‡ªåŠ¨å®Œæˆå…¨é¢è¯Šæ–­å¹¶è¾“å‡ºä¸“ä¸šæŠ¥å‘Šã€‚

```
è¾“å…¥ï¼ši-bp1xxxxxxxxxxï¼ˆå®ä¾‹ IDï¼‰
è¾“å‡ºï¼šç»“æ„åŒ–çš„è¯Šæ–­æŠ¥å‘Šï¼ˆé—®é¢˜å®šä½ + è§£å†³å»ºè®®ï¼‰
```

åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œ**å¤§æ¨¡å‹æ‰¿æ‹…ä¸¤ä¸ªæ ¸å¿ƒèŒè´£**ï¼š

1. **æ™ºèƒ½è°ƒåº¦è¯Šæ–­æµç¨‹**
   - å¤§æ¨¡å‹æ ¹æ®å†…ç½®çš„è¯Šæ–­ Prompt æŒ‰éœ€è°ƒç”¨ MCP å·¥å…·
   - è‡ªä¸»å†³å®šè°ƒç”¨é¡ºåºå’Œè°ƒç”¨å“ªäº›å·¥å…·ï¼ˆä¸æ˜¯å›ºå®šæµç¨‹ï¼‰
   - é‡åˆ°å¼‚å¸¸æ•°æ®æ—¶ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ·±æŒ–ç›¸å…³ç»´åº¦

2. **è¾“å‡ºç”¨æˆ·å‹å¥½çš„è¯Šæ–­æŠ¥å‘Š**
   - å°†åŸå§‹çš„ API æ•°æ®ã€ç›‘æ§æŒ‡æ ‡è½¬æ¢ä¸ºè‡ªç„¶è¯­è¨€æè¿°
   - ç»“æ„åŒ–å‘ˆç°é—®é¢˜å’Œå»ºè®®ï¼Œè®©éæŠ€æœ¯äººå‘˜ä¹Ÿèƒ½çœ‹æ‡‚
   - æä¾›å¯æ“ä½œçš„è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸ä»…ä»…æ˜¯æ•°æ®ç½—åˆ—

è¿™æ­£æ˜¯æˆ‘ä»¬æ„å»ºçš„â€”â€”åŸºäº **Dify + MCP Server** çš„æ™ºèƒ½è¯Šæ–­ç³»ç»Ÿã€‚

## äºŒã€æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚     â”‚                 â”‚     â”‚                 â”‚
â”‚      Dify       â”‚â”€â”€â”€â”€â–¶â”‚   MCP Server    â”‚â”€â”€â”€â”€â–¶â”‚  GameCloud API  â”‚
â”‚   ï¼ˆæ¨¡å‹ç¼–æ’ï¼‰    â”‚ MCP â”‚    ï¼ˆæä¾›å·¥å…·ï¼‰   â”‚HTTP â”‚   (äº‘èµ„æºAPI)    â”‚
â”‚                 â”‚â—€â”€â”€â”€â”€â”‚                 â”‚â—€â”€â”€â”€â”€â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â”‚                       â”‚
        â–¼                       â–¼
   è‡ªç„¶è¯­è¨€æŠ¥å‘Š           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   MCP Tools å·¥å…·é›†          â”‚
                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                        â”‚ â€¢ get_instance_detail      â”‚
                        â”‚ â€¢ get_instance_status      â”‚
                        â”‚ â€¢ get_monitor_data         â”‚
                        â”‚ â€¢ get_disks_info           â”‚
                        â”‚ â€¢ get_network_interfaces   â”‚
                        â”‚ â€¢ check_security_group     â”‚
                        â”‚ â€¢ get_console_log          â”‚
                        â”‚ â€¢ create_diagnostic_report â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|---------|------|
| **AI ç¼–æ’å±‚** | Dify | ä½ä»£ç  AI åº”ç”¨å¼€å‘å¹³å°ï¼Œæ”¯æŒ Agent æ¨¡å¼ |
| **åè®®å±‚** | MCP (Model Context Protocol) | Anthropic æå‡ºçš„æ¨¡å‹-å·¥å…·é€šä¿¡åè®® |
| **æœåŠ¡å±‚** | FastMCP + Python 3.12 | MCP Server å®ç°æ¡†æ¶ |
| **API å±‚** | GameCloud/Skyline API | å†…éƒ¨äº‘èµ„æºç®¡ç† API |
| **åŸºç¡€è®¾æ–½** | Redis + HTTPX | é™æµå­˜å‚¨ + å¼‚æ­¥ HTTP å®¢æˆ·ç«¯ |

### ä¸ºä»€ä¹ˆé€‰æ‹© MCPï¼Ÿ

MCP (Model Context Protocol) æ˜¯ Anthropic åœ¨ 2024 å¹´åº•å¼€æºçš„åè®®ï¼Œå®ƒè§£å†³äº†ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š**å¦‚ä½•è®©å¤§æ¨¡å‹å®‰å…¨ã€æ ‡å‡†åŒ–åœ°è°ƒç”¨å¤–éƒ¨å·¥å…·**ã€‚

ç›¸æ¯”ä¼ ç»Ÿçš„ Function Callingï¼ŒMCP çš„ä¼˜åŠ¿ï¼š

1. **åè®®æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„å·¥å…·æè¿°å’Œè°ƒç”¨è§„èŒƒ
2. **å®‰å…¨å¯æ§**ï¼šå†…ç½®è®¤è¯ã€é™æµç­‰å®‰å…¨æœºåˆ¶
3. **è§£è€¦æ¸…æ™°**ï¼šå·¥å…·æä¾›æ–¹å’Œæ¶ˆè´¹æ–¹å®Œå…¨è§£è€¦
4. **ç”Ÿæ€ä¸°å¯Œ**ï¼šå¯å¤ç”¨çš„å·¥å…·é›†ï¼Œä¸€æ¬¡å¼€å‘å¤šå¤„ä½¿ç”¨

## ä¸‰ã€MCP å·¥å…·è®¾è®¡ä¸å®ç°

### å·¥å…·åˆ†å±‚è®¾è®¡

æˆ‘ä»¬å°†è¯Šæ–­å·¥å…·æŒ‰åŠŸèƒ½ç»´åº¦è¿›è¡Œäº†åˆ†å±‚è®¾è®¡ï¼š

```
aliyun/instances/diagnostic/
â”œâ”€â”€ basic/          # åŸºç¡€ä¿¡æ¯
â”‚   â”œâ”€â”€ get_instance_detail   # å®ä¾‹é…ç½®ä¿¡æ¯
â”‚   â””â”€â”€ get_instance_status   # è¿è¡ŒçŠ¶æ€
â”œâ”€â”€ monitoring/     # ç›‘æ§æ•°æ®
â”‚   â””â”€â”€ get_monitor_data      # CPU/å†…å­˜/ç½‘ç»œ/ç£ç›˜ç›‘æ§
â”œâ”€â”€ network/        # ç½‘ç»œè¯Šæ–­
â”‚   â”œâ”€â”€ get_network_interfaces    # ç½‘å¡ä¿¡æ¯
â”‚   â””â”€â”€ check_security_group_rules # å®‰å…¨ç»„è§„åˆ™
â”œâ”€â”€ disk/           # ç£ç›˜è¯Šæ–­
â”‚   â””â”€â”€ get_disks_info        # ç£ç›˜é…ç½®
â””â”€â”€ system/         # ç³»ç»Ÿæ—¥å¿—
    â”œâ”€â”€ get_console_log       # æ§åˆ¶å°æ—¥å¿—
    â”œâ”€â”€ get_system_events     # ç³»ç»Ÿäº‹ä»¶
    â””â”€â”€ create_diagnostic_report  # è¯Šæ–­æŠ¥å‘Š
```

### MCP Server â‰  OpenAPI é€ä¼ 

åœ¨è®¾è®¡ MCP å·¥å…·æ—¶ï¼Œä¸€ä¸ªå¸¸è§çš„è¯¯åŒºæ˜¯ï¼š**ç›´æ¥æŠŠ OpenAPI æ¥å£åŒ…è£…æˆ MCP å·¥å…·ï¼ŒåŸæ ·é€ä¼  JSON å“åº”**ã€‚

è¿™ç§åšæ³•å­˜åœ¨ä¸¥é‡é—®é¢˜ï¼š

#### âŒ é—®é¢˜ä¸€ï¼šJSON ç¼–ç å¯¼è‡´å¤§é‡æ— æ•ˆ Token æ¶ˆè€—

æ ‡å‡† JSON æ ¼å¼åŒ…å«å¤§é‡ç»“æ„æ€§å­—ç¬¦ï¼ˆ`{`, `}`, `"`, `:` ç­‰ï¼‰ï¼Œè¿™äº›å¯¹å¤§æ¨¡å‹ç†è§£æ•°æ®æ¯«æ— å¸®åŠ©ï¼Œå´ä¼šæ¶ˆè€—å®è´µçš„ Token é¢„ç®—ã€‚

```json
// åŸå§‹ JSONï¼ˆçº¦ 180 tokensï¼‰
{"cpu_percentage": 45.2, "memory_usage": 67.8, "disk_iops_read": 1234, "disk_iops_write": 567}

// ä½¿ç”¨ TOON æ ¼å¼ï¼ˆçº¦ 80 tokensï¼‰
cpu_percentage:45.2 memory_usage:67.8 disk_iops_read:1234 disk_iops_write:567
```

æœ¬é¡¹ç›®ä½¿ç”¨ **TOON (Token-Oriented Object Notation)** æ ¼å¼ä¼˜åŒ– Token æ¶ˆè€—ï¼Œåœ¨ç›‘æ§æ•°æ®ç­‰å¤§ä½“é‡è¿”å›åœºæ™¯ä¸‹ï¼Œå¯èŠ‚çœ **40-60%** çš„ Tokenã€‚

#### âŒ é—®é¢˜äºŒï¼šJSON Key-Value ç»“æ„å¯¹å¤§æ¨¡å‹ä¸å‹å¥½

å¤§æ¨¡å‹åœ¨ç†è§£ JSON å­—æ®µæ—¶å®¹æ˜“äº§ç”Ÿ**å¹»è§‰**ï¼Œå°¤å…¶æ˜¯å•ä½é—®é¢˜ï¼š

```json
// API åŸå§‹è¿”å›
{"bandwidth": 100, "disk_size": 500, "memory": 8}

// å¤§æ¨¡å‹å¯èƒ½çš„é”™è¯¯ç†è§£ï¼š
// - bandwidth æ˜¯ 100 Mbpsï¼Ÿ100 Kbpsï¼Ÿ100 Gbpsï¼Ÿ
// - disk_size æ˜¯ 500 GBï¼Ÿ500 MBï¼Ÿ500 å—ç£ç›˜ï¼Ÿ
// - memory æ˜¯ 8 GBï¼Ÿ8 MBï¼Ÿ8 ä¸ªå†…å­˜æ¡ï¼Ÿ
```

**è§£å†³æ–¹æ¡ˆ**ï¼šé€šè¿‡ä¸¤ç§æ–¹å¼æ˜¾å¼æ ‡æ³¨å•ä½ï¼Œå½»åº•æ¶ˆé™¤æ­§ä¹‰ï¼š

**æ–¹å¼ä¸€ï¼šåœ¨å­—æ®µåä¸­æ ‡æ³¨å•ä½**

```python
return {
    "internet_bandwidth(kbits/s)": item.internet_bandwidth,
    "disk_size_gb": disk.size,
    "iops_read(æ¬¡/s)": item.iops_read,
    "throughput_mbps": disk.throughput,
}
```

**æ–¹å¼äºŒï¼šåœ¨å­—æ®µå€¼ä¸­ä½¿ç”¨è‡ªç„¶è¯­è¨€æ ‡æ³¨å•ä½ï¼ˆæ¨èï¼‰**

```python
return {
    "internet_bandwidth": f"{item.internet_bandwidth} Mbps",
    "disk_size": f"{disk.size} GB",
    "memory": f"{instance.memory / 1024} GB",
    "iops_read": f"{item.iops_read} æ¬¡/ç§’",
    "throughput": f"{disk.throughput} MB/s",
}
```

ç¬¬äºŒç§æ–¹å¼æ›´å‹å¥½â€”â€”å¤§æ¨¡å‹å¯ä»¥ç›´æ¥å°†å­—æ®µå€¼ç”¨äºç”ŸæˆæŠ¥å‘Šï¼Œæ— éœ€å†åšå•ä½è½¬æ¢ï¼Œå‡å°‘å‡ºé”™å¯èƒ½ã€‚

#### âŒ é—®é¢˜ä¸‰ï¼šAPI åŸå§‹æ•°æ®åŒ…å«å¤§é‡è¯Šæ–­æ— å…³ä¿¡æ¯

äº‘ API è¿”å›çš„æ•°æ®é€šå¸¸å¾ˆå…¨é¢ï¼Œä½†å¯¹äºè¯Šæ–­åœºæ™¯ï¼Œå¾ˆå¤šå­—æ®µæ˜¯å™ªéŸ³ï¼š

```python
# API åŸå§‹è¿”å›çš„å®ä¾‹å¯¹è±¡åŒ…å« 50+ å­—æ®µ
# ä½†è¯Šæ–­åªéœ€è¦å…³æ³¨è¿™äº›æ ¸å¿ƒå­—æ®µï¼š

return {
    "instance_id": instance.instance_id,
    "name": instance.name,
    "instance_type": instance.instance_type,
    "region": instance.region,
    "zone": instance.zone_id,
    "private_ips": instance.private_ips,
    "public_ips": instance.public_ips,
    "os_type": instance.os,
    "cpu_topology_type": instance.cpu_topology_type,
    # åˆ å‡äº†ï¼šåˆ›å»ºè€…ã€æ ‡ç­¾ã€è®¡è´¹ä¿¡æ¯ã€è¿‡æœŸæ—¶é—´ç­‰æ— å…³å­—æ®µ
}
```

### å·¥å…·å®ç°ç¤ºä¾‹

ä»¥è·å–å®ä¾‹è¯¦æƒ…å·¥å…·ä¸ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åšå¥½æ•°æ®é¢„å¤„ç†ï¼š

```python
from fastmcp import FastMCP
from gamecloud_mcp.gamecloud_api_client import check_response_type, client
from gamecloud_mcp.utils import default_serializer

basic_tool = FastMCP(
    name="aliyun/instances/diagnostic/basic/",
    tool_serializer=default_serializer,
)

@basic_tool.tool(
    description="ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„å®ä¾‹IDå»æŸ¥è¯¢ä¸€å°é˜¿é‡Œäº‘å®ä¾‹çš„æ ¸å¿ƒé…ç½®ä¿¡æ¯ï¼Œå®ä¾‹IDæ ¼å¼ä¸ºi-xxxxxx"
)
async def get_instance_detail(instance_id: str) -> dict[str, Any]:
    # è°ƒç”¨ GameCloud API è·å–å®Œæ•´å®ä¾‹ä¿¡æ¯
    instance = check_response_type(
        AliyunInstanceResponseModel, 
        await get_instance(instance_id, client=client)
    )
    
    # åªè¿”å›è¯Šæ–­ç›¸å…³çš„æ ¸å¿ƒå­—æ®µï¼Œåˆ å‡æ— å…³ä¿¡æ¯
    return {
        "instance_id": instance.instance_id,
        "name": instance.name,
        "instance_type": instance.instance_type,
        "region": instance.region,
        "zone": instance.zone_id,
        "vpc_id": instance.vpc_id,
        "private_ips": instance.private_ips,
        "public_ips": instance.public_ips,
        "os_type": instance.os,
        "cpu_topology_type": instance.cpu_topology_type,
    }
```

### ç›‘æ§æ•°æ®çš„æ™ºèƒ½é¢„å¤„ç†

ç›‘æ§æ•°æ®æ˜¯è¯Šæ–­çš„æ ¸å¿ƒä¾æ®ï¼Œä½†ä¹Ÿæ˜¯æœ€å®¹æ˜“è®©å¤§æ¨¡å‹"ç¿»è½¦"çš„åœ°æ–¹ã€‚

#### ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥è¿”å›æ—¶åºæ•°æ®ï¼Ÿ

äº‘ç›‘æ§ API é€šå¸¸è¿”å›è¿™æ ·çš„æ—¶åºæ•°æ®ï¼š

```json
[
  {"timestamp": "2024-01-15T10:00:00Z", "cpu": 45.2, "memory": 67.8},
  {"timestamp": "2024-01-15T10:01:00Z", "cpu": 48.1, "memory": 68.2},
  {"timestamp": "2024-01-15T10:02:00Z", "cpu": 52.3, "memory": 69.1},
  // ... è¿˜æœ‰å‡ ç™¾ä¸ªæ•°æ®ç‚¹
]
```

ç›´æ¥è¿”å›ç»™å¤§æ¨¡å‹ä¼šæœ‰ä¸¥é‡é—®é¢˜ï¼š

**é—®é¢˜ä¸€ï¼šå¤§æ¨¡å‹ä¸æ“…é•¿å¤„ç†æ—¶åºæ•°æ®**

å¤§æ¨¡å‹æ˜¯åŸºäº Transformer æ¶æ„çš„è¯­è¨€æ¨¡å‹ï¼Œå®ƒæ“…é•¿ç†è§£è¯­ä¹‰ï¼Œä½†**ä¸æ“…é•¿æ•°å€¼è®¡ç®—å’Œæ—¶åºæ¨¡å¼è¯†åˆ«**ã€‚ç»™å®ƒä¸€å †æ•°æ®ç‚¹ï¼Œå®ƒå¯èƒ½ä¼šï¼š
- é”™è¯¯è®¡ç®—å¹³å‡å€¼ã€æœ€å¤§å€¼
- æ— æ³•è¯†åˆ«æ•°æ®è¶‹åŠ¿ï¼ˆä¸Šå‡/ä¸‹é™ï¼‰
- å¯¹å¼‚å¸¸å€¼è§†è€Œä¸è§æˆ–è¿‡åº¦æ•æ„Ÿ

**é—®é¢˜äºŒï¼šæ—¶åºæ•°æ®ææ˜“å¼•å‘å¹»è§‰**

```
// åŸå§‹æ•°æ®ï¼šCPU ä» 45% æ¶¨åˆ° 52%
å¤§æ¨¡å‹å¯èƒ½çš„é”™è¯¯è§£è¯»ï¼š
âŒ "CPU ä½¿ç”¨ç‡é£™å‡ï¼Œç³»ç»Ÿå³å°†å´©æºƒ"ï¼ˆè¿‡åº¦è§£è¯» 7% çš„æ³¢åŠ¨ï¼‰
âŒ "CPU å¹³å‡ä½¿ç”¨ç‡çº¦ 30%"ï¼ˆéšæœºçŒœæµ‹ï¼‰
âŒ "CPU å‘ˆç°å‘¨æœŸæ€§æ³¢åŠ¨"ï¼ˆæ— ä¸­ç”Ÿæœ‰ï¼‰
```

**é—®é¢˜ä¸‰ï¼šæµ·é‡æ•°æ®ç‚¹æ¶ˆè€—å¤§é‡ Token**

30 åˆ†é’Ÿçš„åˆ†é’Ÿçº§ç›‘æ§æ•°æ®å°±æœ‰ 30 ä¸ªç‚¹ï¼Œ6 ä¸ªæŒ‡æ ‡å°±æ˜¯ 180 ä¸ªæ•°æ®ç‚¹ã€‚ç›´æ¥è¿”å›ä¼šæ¶ˆè€—æ•°åƒ Tokenï¼Œä¸”å¤§éƒ¨åˆ†æ˜¯æ— æ•ˆä¿¡æ¯ã€‚

#### æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆï¼šé¢„è®¡ç®—ç»Ÿè®¡æ‘˜è¦

ä¸å…¶è®©å¤§æ¨¡å‹åšå®ƒä¸æ“…é•¿çš„äº‹ï¼Œä¸å¦‚**åœ¨ MCP Server å±‚å®Œæˆæ•°æ®åˆ†æï¼Œåªç»™å¤§æ¨¡å‹ç»“è®ºæ€§ä¿¡æ¯**ï¼š

```python
def analyze_metric(dataset: list[dict]):
    """å°†æ—¶åºç›‘æ§æ•°æ®èšåˆä¸ºç»Ÿè®¡æ‘˜è¦"""
    df = pandas.DataFrame(dataset)
    
    # è®¡ç®—ç»Ÿè®¡æŒ‡æ ‡ï¼ˆå¤§æ¨¡å‹ä¸æ“…é•¿çš„äº‹ï¼Œæˆ‘ä»¬æ¥åšï¼‰
    stats = df.describe(percentiles=[0.25, 0.5, 0.75, 0.95])
    
    # è®¡ç®—è¶‹åŠ¿ï¼ˆç”¨çº¿æ€§å›å½’æ‹Ÿåˆæ–œç‡ï¼‰
    for column in df.columns:
        trend_slope, trend_desc = _evaluate_series_trend(df[column])
        stats.loc["current"] = df[column].iloc[-1]        # å½“å‰å€¼
        stats.loc["trend_slope"] = trend_slope            # è¶‹åŠ¿æ–œç‡
        stats.loc["trend_desc"] = trend_desc              # äººç±»å¯è¯»çš„è¶‹åŠ¿æè¿°
    
    return stats.to_dict()

def _evaluate_series_trend(series: pandas.Series):
    """è¯„ä¼°æ—¶åºæ•°æ®è¶‹åŠ¿"""
    if len(series) <= 1:
        return float("nan"), "Insufficient Data"
    
    # çº¿æ€§å›å½’æ‹Ÿåˆ
    slope, _ = np.polyfit(np.arange(len(series)), series, 1)
    
    # è½¬åŒ–æˆäººç±»è¯­è¨€ç»™ LLMï¼ˆæ¶ˆé™¤æ­§ä¹‰ï¼‰
    if slope > 0.5:
        return slope, "Rapidly Rising (å¿«é€Ÿä¸Šå‡)"
    elif slope > 0.05:
        return slope, "Slowly Rising (ç¼“æ…¢ä¸Šå‡)"
    elif slope < -0.5:
        return slope, "Rapidly Falling (å¿«é€Ÿä¸‹é™)"
    elif slope < -0.05:
        return slope, "Slowly Falling (ç¼“æ…¢ä¸‹é™)"
    else:
        return slope, "Stable (å¹³ç¨³)"
```

#### é¢„å¤„ç†åçš„æ•°æ®ç»“æ„

```json
{
  "cpu_metrics": {
    "cpu_percentage": {
      "mean": 45.2,
      "std": 3.8,
      "min": 38.1,
      "max": 56.7,
      "p95": 52.3,
      "current": 48.5,
      "trend_desc": "Stable (å¹³ç¨³)"
    }
  }
}
```

#### è¿™æ ·åšçš„ä¼˜åŠ¿

| å¯¹æ¯”ç»´åº¦ | åŸå§‹æ—¶åºæ•°æ® | é¢„å¤„ç†åçš„ç»Ÿè®¡æ‘˜è¦ |
|---------|-------------|------------------|
| **Token æ¶ˆè€—** | æ•°åƒ tokens | çº¦ 100 tokens |
| **å¤§æ¨¡å‹ç†è§£éš¾åº¦** | é«˜ï¼ˆéœ€è¦æ•°å€¼è®¡ç®—ï¼‰ | ä½ï¼ˆç›´æ¥è¯»ç»“è®ºï¼‰ |
| **å¹»è§‰é£é™©** | é«˜ï¼ˆå®¹æ˜“è¯¯åˆ¤è¶‹åŠ¿ï¼‰ | ä½ï¼ˆè¶‹åŠ¿å·²é¢„è®¡ç®—ï¼‰ |
| **è¯Šæ–­å‡†ç¡®æ€§** | ä¾èµ–å¤§æ¨¡å‹æ•°å­¦èƒ½åŠ› | ç”±ä»£ç ä¿è¯æ­£ç¡®æ€§ |

å¤§æ¨¡å‹æ‹¿åˆ°é¢„å¤„ç†åçš„æ•°æ®ï¼Œå¯ä»¥ç›´æ¥è¾“å‡ºï¼š

> "CPU ä½¿ç”¨ç‡å¹³å‡ 45.2%ï¼ŒP95 ä¸º 52.3%ï¼Œå½“å‰ 48.5%ï¼Œæ•´ä½“**è¶‹åŠ¿å¹³ç¨³**ï¼Œå±äºæ­£å¸¸æ°´å¹³ã€‚"

è€Œä¸æ˜¯åœ¨ä¸€å †æ•°æ®ç‚¹é‡Œè¿·å¤±æ–¹å‘ã€‚

## å››ã€Prompt å·¥ç¨‹å®è·µ

### System Prompt æ ¸å¿ƒç»“æ„

```markdown
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„äº‘è®¡ç®—è¿ç»´ä¸“å®¶ã€‚è¯·ååŠ©ç”¨æˆ·è¯Šæ–­å®ä¾‹ã€‚

## è¯Šæ–­æµç¨‹
1. æ”¶é›†åŸºæœ¬ä¿¡æ¯ï¼ˆæ£€æŸ¥å®ä¾‹çŠ¶æ€ï¼‰
2. ç›‘æ§æ•°æ®åˆ†æï¼ˆCPUã€ç£ç›˜ã€ç½‘ç»œï¼‰
3. ç»¼åˆè¯Šæ–­æŠ¥å‘Šï¼ˆå¥åº·æ£€æŸ¥ã€å®‰å…¨è¯„ä¼°ï¼‰
4. ä¸²å£æ—¥å¿—åˆ†æï¼ˆæ£€æŸ¥ OOMã€Panicã€Failed ç­‰å…³é”®è¯ï¼‰

## è¯Šæ–­åŸåˆ™
- **æ•°æ®é©±åŠ¨**ï¼šåŸºäºå®é™…ç›‘æ§æ•°æ®åˆ†æï¼Œé¿å…ä¸»è§‚è‡†æ–­
- **å¯æ“ä½œæ€§**ï¼šæä¾›å…·ä½“ã€å¯æ‰§è¡Œçš„è§£å†³æ–¹æ¡ˆ

## âš ï¸ æ³¨æ„äº‹é¡¹
- å¦‚æœæ—¥å¿—ä¿¡æ¯ä¸è¶³ä»¥åˆ¤æ–­ï¼Œè¯·ç›´æ¥å›ç­”"ä¿¡æ¯ä¸è¶³ï¼Œæ— æ³•ç¡®è¯Š"

## è¾“å‡ºæ ¼å¼
### ğŸ©º è¯Šæ–­ç»“è®º
[ç”¨ç®€çŸ­çš„è¯­è¨€æè¿°æ ¸å¿ƒé—®é¢˜]

### ğŸ” è¯æ®åˆ†æ
- **ç°è±¡**ï¼š[æè¿°ä½ çœ‹åˆ°çš„æŒ‡æ ‡æˆ–æ—¥å¿—]
- **æ ¹å› **ï¼š[è§£é‡ŠæŠ€æœ¯åŸå› ]

### ï¿½ ä¿®å¤å»ºè®®
1. [å»ºè®®ä¸€]
2. [å»ºè®®äºŒ]
```

### Prompt è®¾è®¡å¿ƒå¾—

#### æ ¸å¿ƒåŸåˆ™ï¼šæä¾›å®Œæ•´çš„è¾“å‡ºæ ¼å¼æ¨¡æ¿

å¤§æ¨¡å‹æ¯æ¬¡ç”Ÿæˆçš„å†…å®¹å…·æœ‰ä¸€å®šéšæœºæ€§ã€‚å¦‚æœä¸çº¦æŸè¾“å‡ºæ ¼å¼ï¼ŒåŒä¸€ä¸ªé—®é¢˜å¯èƒ½å¾—åˆ°é£æ ¼è¿¥å¼‚çš„è¯Šæ–­æŠ¥å‘Šã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ Prompt ä¸­æä¾›**å®Œæ•´çš„è¾“å‡ºæ ¼å¼æ¨¡æ¿**ï¼ŒåŒ…æ‹¬ï¼š
- å›ºå®šçš„ç« èŠ‚æ ‡é¢˜ï¼ˆğŸ©º è¯Šæ–­ç»“è®ºã€ğŸ” è¯æ®åˆ†æã€ğŸ›  ä¿®å¤å»ºè®®ï¼‰
- æ¯ä¸ªç« èŠ‚çš„å†…å®¹å ä½ç¬¦
- æ˜ç¡®çš„æ ¼å¼è¦æ±‚ï¼ˆç»“æ„åŒ– Markdownï¼‰

è¿™æ ·å¯ä»¥ï¼š
1. **é™ä½è¾“å‡ºä¸ä¸€è‡´çš„æ¦‚ç‡**ï¼šå¤§æ¨¡å‹ä¼šä¸¥æ ¼æŒ‰ç…§æ¨¡æ¿å¡«å……å†…å®¹
2. **æ–¹ä¾¿å‰ç«¯æ¸²æŸ“**ï¼šå›ºå®šç»“æ„çš„æŠ¥å‘Šæ›´å®¹æ˜“åš UI å±•ç¤º
3. **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šç”¨æˆ·æ¯æ¬¡çœ‹åˆ°çš„æŠ¥å‘Šæ ¼å¼ä¸€è‡´ï¼Œæ›´ä¸“ä¸š

#### å…¶ä»–è®¾è®¡è¦ç‚¹

| è®¾è®¡ç‚¹ | åšæ³• | åŸå›  |
|-------|------|------|
| **è¯Šæ–­æµç¨‹** | æ˜ç¡®åˆ—å‡ºæ­¥éª¤ | å¼•å¯¼å¤§æ¨¡å‹æŒ‰é¡ºåºè°ƒç”¨å·¥å…·ï¼Œé¿å…é—æ¼ |
| **è¯Šæ–­åŸåˆ™** | å¼ºè°ƒ"æ•°æ®é©±åŠ¨" | å‡å°‘å¤§æ¨¡å‹ä¸»è§‚è‡†æ–­ï¼Œé™ä½å¹»è§‰ |
| **æ³¨æ„äº‹é¡¹** | å…è®¸å›ç­”"ä¿¡æ¯ä¸è¶³" | é¿å…å¤§æ¨¡å‹åœ¨ä¿¡æ¯ä¸è¶³æ—¶å¼ºè¡Œç»™å‡ºé”™è¯¯ç»“è®º |
| **å…³é”®è¯æç¤º** | åˆ—å‡º OOMã€Panicã€Failed | å¸®åŠ©å¤§æ¨¡å‹åœ¨æ—¥å¿—ä¸­å¿«é€Ÿå®šä½é—®é¢˜ |

### å·¥å…·è°ƒç”¨é“¾ç¤ºä¾‹

```
ç”¨æˆ·è¾“å…¥: i-bp1xxxxxxxxxx

Step 1: æ”¶é›†åŸºæœ¬ä¿¡æ¯
â†’ è°ƒç”¨ get_instance_status     # æ£€æŸ¥å®ä¾‹çŠ¶æ€

Step 2: ç›‘æ§æ•°æ®åˆ†æ  
â†’ è°ƒç”¨ get_monitor_data        # è·å– CPU/ç£ç›˜/ç½‘ç»œç›‘æ§

Step 3: ç»¼åˆè¯Šæ–­æŠ¥å‘Š
â†’ è°ƒç”¨ create_diagnostic_report # è·å–é˜¿é‡Œäº‘å®˜æ–¹è¯Šæ–­

Step 4: ä¸²å£æ—¥å¿—åˆ†æ
â†’ è°ƒç”¨ get_console_log         # è·å–æ§åˆ¶å°æ—¥å¿—

Agent ç»¼åˆåˆ†æï¼Œè¾“å‡ºç»“æ„åŒ–è¯Šæ–­æŠ¥å‘Š
```

## äº”ã€å¼€å‘å¿ƒå¾—ä¸æœ€ä½³å®è·µ

### 1. å·¥å…·ç²’åº¦çš„æŠŠæ¡

**è¸©å‘**ï¼šæœ€åˆæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ª"ä¸€é”®è¯Šæ–­"å·¥å…·ï¼Œè¿”å›æ‰€æœ‰ä¿¡æ¯ã€‚ç»“æœå‘ç°ï¼š
- Token æ¶ˆè€—å·¨å¤§
- å¤§æ¨¡å‹ä¿¡æ¯è¿‡è½½ï¼Œåˆ†æè´¨é‡ä¸‹é™
- ä¸å¤Ÿçµæ´»ï¼Œæ— æ³•é’ˆå¯¹æ€§è¯Šæ–­

**æ”¹è¿›**ï¼šæ‹†åˆ†ä¸ºå¤šä¸ªç»†ç²’åº¦å·¥å…·ï¼Œè®©å¤§æ¨¡å‹æŒ‰éœ€è°ƒç”¨ã€‚

### 2. è¿”å›æ•°æ®çš„é¢„å¤„ç†

**è¸©å‘**ï¼šç›´æ¥è¿”å› API åŸå§‹å“åº”ï¼ŒåŒ…å«å¤§é‡å†—ä½™å­—æ®µã€‚

**æ”¹è¿›**ï¼š
- åªè¿”å›è¯Šæ–­ç›¸å…³çš„æ ¸å¿ƒå­—æ®µ
- å¯¹æ—¶åºæ•°æ®åšç»Ÿè®¡èšåˆ
- æ·»åŠ äººç±»å¯è¯»çš„æè¿°ï¼ˆå¦‚è¶‹åŠ¿åˆ¤æ–­ï¼‰

### 3. é”™è¯¯å¤„ç†çš„ä¼˜é›…é™çº§

```python
@tool.tool(description="...")
async def get_instance_status(instance_id: str) -> dict[str, Any]:
    try:
        result = await fetch_status(instance_id)
        return result.to_dict()
    except APIError as e:
        # è¿”å›ç»“æ„åŒ–é”™è¯¯ï¼Œè€Œä¸æ˜¯æŠ›å¼‚å¸¸
        return {"error_msg": f"æŸ¥è¯¢å®ä¾‹çŠ¶æ€å¤±è´¥: {e.message}"}
```

è¿™æ ·å¤§æ¨¡å‹å¯ä»¥ç†è§£"è¿™ä¸ªå·¥å…·è°ƒç”¨å¤±è´¥äº†"ï¼Œå¹¶å°è¯•å…¶ä»–é€”å¾„ã€‚

### 4. è®¤è¯ä¸å®‰å…¨

MCP Server é€šè¿‡ä¸­é—´ä»¶æ ˆå¤„ç†å®‰å…¨é—®é¢˜ï¼š

```python
# ä¸­é—´ä»¶æ‰§è¡Œé¡ºåº
app.add_middleware(AuthMiddleware())      # 1. éªŒè¯ Token
app.add_middleware(RateLimitMiddleware()) # 2. é™æµä¿æŠ¤
app.add_middleware(ErrorHandlingMiddleware()) # 3. ç»Ÿä¸€é”™è¯¯å¤„ç†
```

å…³é”®å®‰å…¨æªæ–½ï¼š
- Token é€ä¼ åˆ°ä¸‹æ¸¸ APIï¼Œä¸åšå­˜å‚¨
- åŸºäºç”¨æˆ· ID çš„è¯·æ±‚é™æµ
- æ•æ„Ÿä¿¡æ¯ä¸å†™å…¥æ—¥å¿—
