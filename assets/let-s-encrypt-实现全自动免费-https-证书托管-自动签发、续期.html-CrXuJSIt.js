import{_ as t,r,o as l,c as d,f as e,g as n,i,e as a}from"./app-C9ZkQdtL.js";const c="/img/Chromeä¸å®‰å…¨æ¼”ç¤º.png",o="/img/Chromeä¸å®‰å…¨æ¼”ç¤º(çº¢è‰²).png",m={},u=a('<h2 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€"><span>å‰è¨€</span></a></h2><p>ä¸ºäº†æ¨åŠ¨æ›´å®‰å…¨çš„ HTTPS åŠ å¯†åè®®æ™®åŠå…¨ç½‘ï¼Œè°·æ­Œ Chrome æµè§ˆå™¨ä» 2017 å¹´å¼€å§‹é€æ­¥å¯¹HTTPç½‘ç«™æ ‡è®° <strong>â€œä¸å®‰å…¨â€</strong> è­¦å‘Šï¼Œå¹¶åœ¨ 2018å¹´7æœˆ24æ—¥ å‘å¸ƒçš„ Chrome 68 æ­£å¼ç‰ˆæœ¬ä¸­å°†æ‰€æœ‰ HTTP ç½‘ç«™æ ‡è®° <strong>â€œä¸å®‰å…¨â€</strong>ã€‚</p><figure><img src="'+c+'" alt="Chromeä¸å®‰å…¨æ¼”ç¤ºå›¾ç‰‡" tabindex="0" loading="lazy"><figcaption>Chromeä¸å®‰å…¨æ¼”ç¤ºå›¾ç‰‡</figcaption></figure><p>éšç€ Chrome 68 ç‰ˆæœ¬çš„è¦†ç›–èŒƒå›´ï¼ŒHTTPç½‘ç«™ä¸Šçš„â€œä¸å®‰å…¨â€è­¦å‘Šå°†è¢«è¶Šæ¥è¶Šå¤šçš„Chromeç”¨æˆ·çœ‹åˆ°ã€‚å› æ­¤ï¼Œä½¿ç”¨ HTTPS åŠ å¯†åè®®æé«˜ç½‘ç«™å®‰å…¨æ€§æ˜¯æ¯ä¸ªç½‘ç«™æ‰€æœ‰è€…çš„ä¹‰åŠ¡ã€‚<br> ä½†æ˜¯ï¼Œä¸ºäº†ç¡®ä¿ç§é’¥å®‰å…¨ï¼ŒSSL/TLS è¯ä¹¦éƒ½è®¾ç½®äº†æœ‰æ•ˆæœŸé™ï¼Œæœ€æ–°çš„å›½é™…æ ‡å‡†ä¸­SSLè¯ä¹¦æœ€é•¿æœ‰æ•ˆæœŸä¸º<strong>1å¹´</strong>ã€‚å¦‚æœç½‘ç«™ä½¿ç”¨çš„ SSL è¯ä¹¦å·²è¿‡æœŸï¼Œé‚£ä¹ˆ Chrome åè€Œä¼šå‡ºç° <strong>çº¢è‰²â€œä¸å®‰å…¨â€</strong> è­¦å‘Šã€‚</p><figure><img src="'+o+'" alt="Chromeä¸å®‰å…¨æ¼”ç¤º(çº¢è‰²)å›¾ç‰‡" tabindex="0" loading="lazy"><figcaption>Chromeä¸å®‰å…¨æ¼”ç¤º(çº¢è‰²)å›¾ç‰‡</figcaption></figure><p>è™½ç„¶æ¨åŠ¨ HTTPS åè®®çš„åˆè¡·æ˜¯å¥½çš„ï¼Œä½†æ˜¯å¹¶éæ‰€æœ‰ç½‘ç«™éƒ½éœ€è¦ HTTPS åè®®ä¿æŠ¤(ä¾‹å¦‚ä½ æ­£åœ¨è®¿é—®çš„é™æ€ç½‘ç«™ -- åšå®¢)ã€‚ä¸ºäº†é¿å…ç½‘ç«™è¢«æç¤ºä¸å®‰å…¨ï¼ŒChrome 68 çš„ç­–ç•¥æ— ç–‘å¤§å¹…æé«˜äº†ç½‘ç«™è¿è¥äººå‘˜çš„å·¥ä½œé‡ -- <strong>éœ€è¦å®šæœŸæ£€æŸ¥è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼Œé¿å…è¢«æ ‡è®°ä¸ºæ›´å“äººçš„çº¢è‰²â€œä¸å®‰å…¨â€è­¦å‘Š</strong>ã€‚</p><p>åŸºäºä¸Šè¿°èƒŒæ™¯ï¼Œæœ¬æ–‡ä»‹ç»ä¸€ç§è§£æ”¾è¯ä¹¦ç»´æŠ¤çš„å·¥ä½œé‡çš„æ–¹æ³• -- å…¨è‡ªåŠ¨ Let&#39;s Encrypt è¯ä¹¦æ‰˜ç®¡ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-let-s-encrypt" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-let-s-encrypt"><span>ä»€ä¹ˆæ˜¯ Let&#39;s Encrypt</span></a></h2><p>Letâ€™s Encrypt æ˜¯ä¸€å®¶å…¨çƒæ€§éç›ˆåˆ©çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ï¼Œåœ¨å…¨çƒèŒƒå›´å†…æä¾›äº†<strong>å…è´¹çš„åŸŸåéªŒè¯å‹ï¼ˆDVï¼‰è¯ä¹¦</strong>ã€‚ç½‘ç«™æ‰€æœ‰è€…å¯ä»¥ä½¿ç”¨ Let&#39;s Encrypt è¯ä¹¦æ¥å¯ç”¨å®‰å…¨çš„ HTTPS è¿æ¥ã€‚</p><h2 id="å¦‚ä½•ç”³è¯·-let-s-encrypt-è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç”³è¯·-let-s-encrypt-è¯ä¹¦"><span>å¦‚ä½•ç”³è¯· Let&#39;s Encrypt è¯ä¹¦</span></a></h2>',10),v={href:"https://www.rfc-editor.org/rfc/rfc8555",target:"_blank",rel:"noopener noreferrer"},b=e("strong",null,"ACME(Automatic Certificate Management Environment) åè®®",-1),h=e("br",null,null,-1),p=a(`<ul><li>é¦–å…ˆ, å‘ Let&#39;s Encrypt è¯æ˜ Web æœåŠ¡åŸŸåçš„<strong>æ‰€æœ‰æƒ</strong>ã€‚<em>(ä¸å…¶ä»– CA æœºæ„ä¸€æ ·, é¢å‘ DV è¯ä¹¦éƒ½éœ€è¦è¯æ˜åŸŸåæ‰€æœ‰æƒ)</em></li><li>ç„¶å, è°ƒç”¨ Let&#39;s Encrypt æä¾›çš„ API é¢å‘ã€ç»­æœŸæˆ–åŠé”€è¯¥åŸŸåçš„è¯ä¹¦ã€‚</li></ul><h3 id="let-s-encrypt-çš„å·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#let-s-encrypt-çš„å·¥ä½œåŸç†"><span>Let&#39;s Encrypt çš„å·¥ä½œåŸç†</span></a></h3><p>Let&#39;s Encrypt é€šè¿‡å…¬ç§å¯†é’¥å¯¹éªŒè¯å’ŒåŒºåˆ†ä¸åŒçš„ ACME å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ä¸ºäº†è®¤è¯åŸŸåçš„æ‰€æœ‰æƒ, ACME åè®®ç›®å‰æä¾›äº† 3 ç§è®¤è¯çš„æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ <code>HTTP 01</code>ã€<code>DNS 01</code> å’Œ <code>TLS-ALPN-01</code>ã€‚æˆ‘ä»¬å¯é€šè¿‡ä¸‹é¢çš„æµç¨‹å›¾äº†è§£åŸŸåè®¤è¯çš„å¤§è‡´æµç¨‹ã€‚</p><div class="language-plantuml line-numbers-mode" data-ext="plantuml" data-title="plantuml"><pre class="language-plantuml"><code><img src="https://www.plantuml.com/plantuml/svg/jLD5bjim6Dxh52eFmwRCpCpSscgUtpXoiB0QPcPcfl1hEBbC93ktg6eD1Clrng8FVZfhjRspsEn66UoHi23RHGHFoef1iPRBo6P5MB1yCTbEPrrYWuG_PnyBo69xh-HuByYANVmWlxEWqm2yiziKR3U-HnO0J4nT4YJJEso3EYby0I3xJkxd4lgcb7twuWbw_m1PFZBWgtIeYAqxm1IjTFJ5smzASyEtVEzIy7q6_jo5MvTAByWImhPCWfHaxP2adEKWId42jkLBJwSI7OVKkqAQEZJV4ctn5rn_SgCGfEgmrnp8Nchn0J8-nLwIRl-Z-pSBgYInC2yjQHaduP3ch4q4bpJ77EaSB10Lupi9bq26-wc8Ou51a_qnshL8-ZeIWHgwCKjhbfDZtNGYH0TT1LZ10ielhpdYoM57AWtjd2FTG_m4FbIg4Fw91tZX7AG3JjfHguurS1mT2f98Dm06Ys8tmQiF7zujhQZKixtRRl18MINKprAywNt6aZAneeQMY6DCypj9h84EnDIeGzsCaPvEfi5DSMIUfFQsgTEBTAAJjCsIqHNYzz3mhFRLozrfJZzrr-a4AQWKUPwKL0V9jGu69DFJp05jhQ4JhNIo7Y0iRiV8slaNGsJJmPh97oPjC_3XquTCp4MYWwJ5bQhtNw9ZodyKsyER3qhFtRnxEq-0_xKIyN5jjkEx0qYxPsbhUqwp1VnKNQvDzYqMSkif9e_cRs3UhIqzf6qwxuWa0krQDCed582pZDrkbBy1
"></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="æµç¨‹æ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#æµç¨‹æ¼”ç¤º"><span>æµç¨‹æ¼”ç¤º</span></a></h3>`,5),y={href:"https://github.com/acmesh-official/acme.sh",target:"_blank",rel:"noopener noreferrer"},g=e("code",null,"DNS-01",-1),f=a(`<h4 id="step-1-å‘èµ·åŸŸåè¯ä¹¦ç”³è¯·è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#step-1-å‘èµ·åŸŸåè¯ä¹¦ç”³è¯·è¯·æ±‚"><span>Step 1. å‘èµ·åŸŸåè¯ä¹¦ç”³è¯·è¯·æ±‚</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>## å¯åŠ¨å®¹å™¨ acme.sh å®¹å™¨
â¯ docker run --rm -it neilpang/acme.sh sh
## æ³¨å†Œè´¦å·
â¯ acme.sh --register-account -m shabbywu@qq.com --server letsencrypt

Create account key ok.
Registering account: https://acme-v02.api.letsencrypt.org/directory
Registered
ACCOUNT_THUMBPRINT=&#39;******&#39;

## ä½¿ç”¨æ‰‹åŠ¨æ¨¡å¼ç”³è¯·åŸŸåè¯ä¹¦
â¯ acme.sh --issue --dns -d test.shabbywu.cn --server letsencrypt --yes-I-know-dns-manual-mode-enough-go-ahead-please

Using CA: https://acme-v02.api.letsencrypt.org/directory
Creating domain key
The domain key is here: /acme.sh/test.shabbywu.cn/test.shabbywu.cn.key
Single domain=&#39;test.shabbywu.cn&#39;
Getting domain auth token for each domain
Getting webroot for domain=&#39;test.shabbywu.cn&#39;
Add the following TXT record:
Domain: &#39;_acme-challenge.test.shabbywu.cn&#39;
TXT value: &#39;zvXo7P0nyVh-4AQ_IZyfbqajoKkpaLCku60W80DFCeI&#39;
Please be aware that you prepend _acme-challenge. before your domain
so the resulting subdomain will be: _acme-challenge.test.shabbywu.cn
Please add the TXT records to the domains, and re-run with --renew.
Please add &#39;--debug&#39; or &#39;--log&#39; to check more details.
See: https://github.com/acmesh-official/acme.sh/wiki/How-to-debug-acme.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="step-2-æ·»åŠ -dns-è®°å½•å¹¶éªŒè¯" tabindex="-1"><a class="header-anchor" href="#step-2-æ·»åŠ -dns-è®°å½•å¹¶éªŒè¯"><span>Step 2. æ·»åŠ  DNS è®°å½•å¹¶éªŒè¯</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>## è°ƒç”¨ DNSPOD API æ·»åŠ  DNS è®°å½•
â¯ curl -X POST https://dnsapi.cn/Record.Create -d &quot;login_token=$DP_Id,$DP_Key&amp;format=json&amp;domain=shabbywu.cn&amp;sub_domain=_acme-challenge.test&amp;record_type=TXT&amp;ttl=600&amp;record_line=é»˜è®¤&amp;value=zvXo7P0nyVh-4AQ_IZyfbqajoKkpaLCku60W80DFCeI&quot;
## éªŒè¯ DNS è®°å½•
â¯ dig -t TXT _acme-challenge.test.shabbywu.cn +short
&quot;zvXo7P0nyVh-4AQ_IZyfbqajoKkpaLCku60W80DFCeI&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="step-3-è·å–åŸŸåè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#step-3-è·å–åŸŸåè¯ä¹¦"><span>Step 3. è·å–åŸŸåè¯ä¹¦</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>## é€šçŸ¥ Let&#39;s Encrypt éªŒè¯åŸŸåæ‰€æœ‰æƒå¹¶ä¸‹è½½è¯ä¹¦
â¯ acme.sh --renew -d test.shabbywu.cn --server letsencrypt --yes-I-know-dns-manual-mode-enough-go-ahead-please

Renew: &#39;test.shabbywu.cn&#39;
Renew to Le_API=https://acme-v02.api.letsencrypt.org/directory
Using CA: https://acme-v02.api.letsencrypt.org/directory
Single domain=&#39;test.shabbywu.cn&#39;
Getting domain auth token for each domain
Verifying: test.shabbywu.cn
Pending, The CA is processing your order, please just wait. (1/30)
Pending, The CA is processing your order, please just wait. (2/30)
Success
Verify finished, start to sign.
Lets finalize the order.
Le_OrderFinalize=&#39;https://acme-v02.api.letsencrypt.org/acme/finalize/820949067/143403376067&#39;
Downloading cert.
Le_LinkCert=&#39;https://acme-v02.api.letsencrypt.org/acme/cert/03ea91f35baf0a82ffda0d4bffbf2ea76a12&#39;
Cert success.
-----BEGIN CERTIFICATE-----
******
******
-----END CERTIFICATE-----
Your cert is in: /acme.sh/test.shabbywu.cn/test.shabbywu.cn.cer
Your cert key is in: /acme.sh/test.shabbywu.cn/test.shabbywu.cn.key
The intermediate CA cert is in: /acme.sh/test.shabbywu.cn/ca.cer
And the full chain certs is there: /acme.sh/test.shabbywu.cn/fullchain.cer

## [Optional] è°ƒç”¨ DNSPOD API åˆ é™¤ DNS è®°å½•
â¯ curl -X POST https://dnsapi.cn/Record.Remove -d &quot;login_token=$DP_Id,$DP_Key&amp;format=json&amp;domain=shabbywu.cn&amp;record_id=1246824242&quot;

## éªŒè¯ HTTPS è¯ä¹¦æœ‰æ•ˆæ€§
### ä¸‹è½½ CA è¯ä¹¦
â¯ wget https://letsencrypt.org/certs/lets-encrypt-r3.pem
### éªŒè¯è¯ä¹¦æœ‰æ•ˆæ€§
â¯ openssl verify -CAfile lets-encrypt-r3.pem /acme.sh/test.shabbywu.cn/ca.cer /acme.sh/test.shabbywu.cn/test.shabbywu.cn.cer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="step-4-optional-åŠé”€åŸŸåè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#step-4-optional-åŠé”€åŸŸåè¯ä¹¦"><span>Step 4. [Optional]åŠé”€åŸŸåè¯ä¹¦</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>## åŠé”€è¯ä¹¦
â¯ acme.sh --remove -d test.shabbywu.cn --server letsencrypt 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äºç­¾å‘çš„è¯ä¹¦é‡å¤ªå¤§ï¼Œå› æ­¤ Let&#39;s Encrypt å¹¶æœªæä¾› CRL(è¯ä¹¦åŠé”€åˆ—è¡¨) æŸ¥è¯¢åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´å³ä½¿åŠé”€äº†è¯ä¹¦ï¼Œä¹Ÿæ— æ³•æŸ¥è¯¢åˆ°åŠé”€ç»“æœğŸ˜‚ã€‚</p><h2 id="å…¨è‡ªåŠ¨æ‰˜ç®¡-let-s-encrypt-è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#å…¨è‡ªåŠ¨æ‰˜ç®¡-let-s-encrypt-è¯ä¹¦"><span>å…¨è‡ªåŠ¨æ‰˜ç®¡ Let&#39;s Encrypt è¯ä¹¦</span></a></h2><p>ACME åè®®ä½¿å¾—å…¨è‡ªåŠ¨ç­¾å‘å’Œç»­ç­¾è¯ä¹¦æˆä¸ºå¯èƒ½ã€‚ç›®å‰è¾ƒä¸ºçƒ­é—¨çš„ ACME å®¢æˆ·ç«¯éƒ½æä¾›äº†å…¨è‡ªåŠ¨æ‰˜ç®¡çš„é…ç½®æ–¹å¼ã€‚ ä»¥ä¸‹åˆ†åˆ«ä»‹ç» 2 ç§å…¨è‡ªåŠ¨æ‰˜ç®¡ Let&#39;s Encrypt è¯ä¹¦çš„æ–¹å¼ã€‚</p><h3 id="å®šæ—¶ä»»åŠ¡-linux-cron" tabindex="-1"><a class="header-anchor" href="#å®šæ—¶ä»»åŠ¡-linux-cron"><span>å®šæ—¶ä»»åŠ¡ - linux cron</span></a></h3><p><code>acme.sh</code> æ˜¯ Bash ä¸Šçš„ ACME å®¢æˆ·ç«¯å®ç°ï¼Œå¯è½»æ¾å€ŸåŠ© <code>linux cron</code> å®šæ—¶ä»»åŠ¡å®ç°è¯ä¹¦çš„å®šæ—¶ç»­æœŸæ“ä½œã€‚<br><code>acme.sh</code> æä¾›äº†å¤šç§æ–¹å¼å®ç°åŸŸåè‡ªåŠ¨åŒ–è®¤è¯ï¼Œä¸ä»…å¯ä»¥ä¸ <code>nginx</code>, <code>apache</code> ç­‰ä¸»æµ web server é…åˆè‡ªåŠ¨å®Œæˆ <code>HTTP-01</code> è®¤è¯ï¼Œè¿˜æä¾›äº†ä¸ä¾èµ–å‰ç«¯ web server çš„ <code>standalone</code> æ¨¡å¼è‡ªåŠ¨å®ŒæˆåŸŸåæ‰€æœ‰æƒè®¤è¯(éœ€è¦ç›‘å¬ç«¯å£æ¥å—ç½‘ç»œè¯·æ±‚)ã€‚<br> å¦‚æœåŸŸåå°šæœªèƒ½æä¾› HTTP æœåŠ¡, äº¦å¯ä»¥å€ŸåŠ© <code>dnsapi</code> è‡ªåŠ¨å®Œæˆ <code>DNS-01</code> è®¤è¯ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>## è‡ªåŠ¨ DNS è®¤è¯
â¯ acme.sh --issue --dns dns_dp -d test.shabbywu.cn --server letsencrypt 
Using CA: https://acme-v02.api.letsencrypt.org/directory
Create account key ok.
Registering account: https://acme-v02.api.letsencrypt.org/directory
Registered
ACCOUNT_THUMBPRINT=&#39;******&#39;
Creating domain key
The domain key is here: /acme.sh/test.shabbywu.cn/test.shabbywu.cn.key
Single domain=&#39;test.shabbywu.cn&#39;
Getting domain auth token for each domain
Getting webroot for domain=&#39;test.shabbywu.cn&#39;
Adding txt value: TMl-MXa3Wmahajj40mioNb-iiljnTK0XSzUhxNWaulw for domain:  _acme-challenge.test.shabbywu.cn
Adding record
The txt record is added: Success.
Let&#39;s check each DNS record now. Sleep 20 seconds first.
You can use &#39;--dnssleep&#39; to disable public dns checks.
See: https://github.com/acmesh-official/acme.sh/wiki/dnscheck
Checking test.shabbywu.cn for _acme-challenge.test.shabbywu.cn
Domain test.shabbywu.cn &#39;_acme-challenge.test.shabbywu.cn&#39; success.
All success, let&#39;s return
Verifying: test.shabbywu.cn
Pending, The CA is processing your order, please just wait. (1/30)
Success
Removing DNS records.
Removing txt: TMl-MXa3Wmahajj40mioNb-iiljnTK0XSzUhxNWaulw for domain: _acme-challenge.test.shabbywu.cn
Removed: Success
Verify finished, start to sign.
Lets finalize the order.
Le_OrderFinalize=&#39;https://acme-v02.api.letsencrypt.org/acme/finalize/821484497/143530627597&#39;
Downloading cert.
Le_LinkCert=&#39;https://acme-v02.api.letsencrypt.org/acme/cert/03fb7dff89b61c4451664ba11f052eec20b2&#39;
Cert success.
-----BEGIN CERTIFICATE-----
******
******
-----END CERTIFICATE-----
Your cert is in: /acme.sh/test.shabbywu.cn/test.shabbywu.cn.cer
Your cert key is in: /acme.sh/test.shabbywu.cn/test.shabbywu.cn.key
The intermediate CA cert is in: /acme.sh/test.shabbywu.cn/ca.cer
And the full chain certs is there: /acme.sh/test.shabbywu.cn/fullchain.cer

## å®‰è£…å®šæ—¶ä»»åŠ¡è„šæœ¬
â¯ acme.sh --install-cronjob
Installing cron job
21 0 * * * &quot;/root/.acme.sh&quot;/acme.sh --cron --home &quot;/root/.acme.sh&quot; --config-home &quot;/acme.sh&quot;

## éªŒè¯å®šæ—¶ä»»åŠ¡
â¯ crontab -l
21 0 * * * &quot;/root/.acme.sh&quot;/acme.sh --cron --home &quot;/root/.acme.sh&quot; --config-home &quot;/acme.sh&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨é›†æˆ-acme-çš„ç½‘å…³-traefik" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨é›†æˆ-acme-çš„ç½‘å…³-traefik"><span>ä½¿ç”¨é›†æˆ ACME çš„ç½‘å…³ - traefik</span></a></h3><p>ä½¿ç”¨ <code>acme.sh</code> è‡ªåŠ¨ç­¾å‘çš„è¯ä¹¦ä»ç„¶éœ€è¦æŒ‚è½½åˆ° Web æœåŠ¡å™¨(æœåŠ¡ç½‘å…³) æ‰èƒ½æ­£ç¡®å¤„ç† HTTPS è¯·æ±‚ã€‚å¦‚æœä¸ä¾èµ–æœåŠ¡ç½‘å…³æä¾›çš„é¢å¤–ç‰¹æ€§(ä¾‹å¦‚ nginx lua ç­‰), æˆ‘ä»¬ä¸å¦¨è€ƒè™‘ä¸€äº›é›†æˆäº† ACME çš„ç½‘å…³ï¼Œä¾‹å¦‚ traefikã€‚</p><h4 id="docker" tabindex="-1"><a class="header-anchor" href="#docker"><span>Docker</span></a></h4><p><code>traefik</code> æ”¯æŒä½¿ç”¨ labels ä¸º Docker å®¹å™¨æ³¨å…¥è·¯ç”±é…ç½®ï¼Œä»¥ä¸‹æ˜¯ä¸€ä»½å¼€å¯äº† <code>ACME</code> é…ç½®æ ·ä¾‹ã€‚</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code>version: &quot;3.3&quot;
services:
  traefik:
    image: &quot;traefik:v2.9&quot;
    container_name: &quot;traefik&quot;
    command:
      - &quot;--api.insecure=true&quot;
      - &quot;--providers.docker=true&quot;
      - &quot;--providers.docker.exposedbydefault=false&quot;
      - &quot;--entrypoints.web.address=:80&quot;
      - &quot;--entrypoints.websecure.address=:443&quot;
      - &quot;--certificatesresolvers.myresolver.acme.dnschallenge=true&quot;
      ## ä½¿ç”¨è…¾è®¯äº‘ API å®Œæˆ DNS-01 è®¤è¯
      - &quot;--certificatesresolvers.myresolver.acme.dnschallenge.provider=tencentcloud&quot;
      - &quot;--certificatesresolvers.myresolver.acme.email=postmaster@example.com&quot;
      - &quot;--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json&quot;
    ports:
      - &quot;80:80&quot;
      - &quot;443:443&quot;
      - &quot;8080:8080&quot;
    environment:
    ## è…¾è®¯äº‘ API çš„é…ç½®
      - &quot;TENCENTCLOUD_SECRET_ID=xxx&quot;
      - &quot;TENCENTCLOUD_SECRET_KEY=xxx&quot;
    volumes:
      - &quot;./letsencrypt:/letsencrypt&quot;
      - &quot;/var/run/docker.sock:/var/run/docker.sock:ro&quot;
  whoami:
    image: &quot;traefik/whoami&quot;
    container_name: &quot;simple-service&quot;
    labels:
      - &quot;traefik.enable=true&quot;
      - &quot;traefik.http.routers.whoami.rule=Host(\`whoami.example.com\`)&quot;
      - &quot;traefik.http.routers.whoami.entrypoints=websecure&quot;
      ## æŒ‡å®š tls è¯ä¹¦ä¾›åº”å•†ä¸º myresolver
      - &quot;traefik.http.routers.whoami.tls.certresolver=myresolver&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="k8s" tabindex="-1"><a class="header-anchor" href="#k8s"><span>K8S</span></a></h4>`,20),_=e("code",null,"traefik",-1),E={href:"https://doc.traefik.io/traefik/providers/kubernetes-ingress/",target:"_blank",rel:"noopener noreferrer"},T=e("strong",null,"K8s Ingress",-1),w={href:"https://doc.traefik.io/traefik/providers/kubernetes-crd/",target:"_blank",rel:"noopener noreferrer"},k=e("strong",null,"IngressRoute(CRD)",-1),C=e("code",null,"Ingress",-1),A=e("code",null,"IngressRoute",-1),q=e("code",null,"ACME",-1),P=a(`<div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code>## Ingress é…ç½®æ ·ä¾‹
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: whoami-ingress
  annotations:
    ## å£°æ˜ traefik è·¯ç”±å…¥å£, é»˜è®¤é…ç½®ä¸‹çš„ websecure æ˜¯ 443 ç«¯å£
    traefik.ingress.kubernetes.io/router.entrypoints: websecure
    ## å£°æ˜å¼€å¯ tls
    traefik.ingress.kubernetes.io/router.tls: &quot;true&quot;
    ## å£°æ˜ tls è¯ä¹¦ä¾›åº”å•†
    traefik.ingress.kubernetes.io/router.tls.certresolver: myresolver
spec:
  rules:
    - host: your.example.com
      http:
        paths:
          - path: /tls
            pathType: Exact
            backend:
              service:
                name:  whoami
                port:
                  number: 80
---
## IngressRoute é…ç½®æ ·ä¾‹
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: simpleingressroute
  namespace: default
spec:
  entryPoints:
    - web
  routes:
  - match: Host(\`your.example.com\`) &amp;&amp; PathPrefix(\`/notls\`)
    kind: Rule
    services:
    - name: whoami
      port: 80

---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: ingressroutetls
  namespace: default
spec:
  entryPoints:
    - websecure
  routes:
  - match: Host(\`your.example.com\`) &amp;&amp; PathPrefix(\`/tls\`)
    kind: Rule
    services:
    - name: whoami
      port: 80
  ## å£°æ˜å¼€åˆ tls å’Œ tls è¯ä¹¦ä¾›åº”å•†
  tls:
    certResolver: myresolver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1);function x(S,I){const s=r("ExternalLinkIcon");return l(),d("div",null,[u,e("p",null,[n("ä¸å…¶ä»–å¸¸è§çš„ CA æœºæ„ä¸åŒ, Let's Encrypt è¯ä¹¦æ˜¯åŸºäº "),e("a",v,[b,i(s)]),n(" å…¨è‡ªåŠ©é¢å‘ã€ç»­æœŸæˆ–åŠé”€çš„ã€‚"),h,n(" ä¸€èˆ¬è€Œè¨€ï¼Œç”³è¯· Let's Encrypt è¯ä¹¦å¯æ‹†åˆ†æˆ 2 ä¸ªæ­¥éª¤ã€‚")]),p,e("p",null,[n("æˆ‘ä»¬ä½¿ç”¨ "),e("a",y,[n("acme.sh"),i(s)]),n(" æ¼”ç¤ºå¦‚ä½•é€šè¿‡ "),g,n(" ç”³è¯· HTTPS è¯ä¹¦ã€‚")]),f,e("p",null,[_,n(" åŒæ—¶æ”¯æŒ "),e("a",E,[T,i(s)]),n(" æˆ–è€… "),e("a",w,[k,i(s)]),n(" è¿›è¡Œè·¯ç”±é…ç½®ã€‚ä»¥ä¸‹æ˜¯åˆ†åˆ«æ˜¯ "),C,n(" å’Œ "),A,n(" å¼€å¯ "),q,n(" é…ç½®æ ·ä¾‹ã€‚")]),P])}const D=t(m,[["render",x],["__file","let-s-encrypt-å®ç°å…¨è‡ªåŠ¨å…è´¹-https-è¯ä¹¦æ‰˜ç®¡-è‡ªåŠ¨ç­¾å‘ã€ç»­æœŸ.html.vue"]]),N=JSON.parse(`{"path":"/posts/2022/11/11/let-s-encrypt-%E5%AE%9E%E7%8E%B0%E5%85%A8%E8%87%AA%E5%8A%A8%E5%85%8D%E8%B4%B9-https-%E8%AF%81%E4%B9%A6%E6%89%98%E7%AE%A1-%E8%87%AA%E5%8A%A8%E7%AD%BE%E5%8F%91%E3%80%81%E7%BB%AD%E6%9C%9F.html","title":"Let's Encrypt - å®ç°å…¨è‡ªåŠ¨å…è´¹ HTTPS è¯ä¹¦æ‰˜ç®¡(è‡ªåŠ¨ç­¾å‘ã€ç»­æœŸ)","lang":"zh-CN","frontmatter":{"draft":false,"permalinkPattern":"/posts/:year/:month/:day/:slug.html","type":"post","filePathRelative":"_posts/sre/2022-11-11-Let's Encrypt - å®ç°å…¨è‡ªåŠ¨å…è´¹ HTTPS è¯ä¹¦æ‰˜ç®¡(è‡ªåŠ¨ç­¾å‘ã€ç»­æœŸ).md","date":"2022-11-11T00:00:00.000Z","title":"Let's Encrypt - å®ç°å…¨è‡ªåŠ¨å…è´¹ HTTPS è¯ä¹¦æ‰˜ç®¡(è‡ªåŠ¨ç­¾å‘ã€ç»­æœŸ)","sidebarDepth":2,"category":"è¿ç»´","tags":["HTTPS","Let's Encrypt","è‡ªåŠ¨åŒ–"],"description":"å‰è¨€ ä¸ºäº†æ¨åŠ¨æ›´å®‰å…¨çš„ HTTPS åŠ å¯†åè®®æ™®åŠå…¨ç½‘ï¼Œè°·æ­Œ Chrome æµè§ˆå™¨ä» 2017 å¹´å¼€å§‹é€æ­¥å¯¹HTTPç½‘ç«™æ ‡è®° â€œä¸å®‰å…¨â€ è­¦å‘Šï¼Œå¹¶åœ¨ 2018å¹´7æœˆ24æ—¥ å‘å¸ƒçš„ Chrome 68 æ­£å¼ç‰ˆæœ¬ä¸­å°†æ‰€æœ‰ HTTP ç½‘ç«™æ ‡è®° â€œä¸å®‰å…¨â€ã€‚ Chromeä¸å®‰å…¨æ¼”ç¤ºå›¾ç‰‡Chromeä¸å®‰å…¨æ¼”ç¤ºå›¾ç‰‡ éšç€ Chrome 68 ç‰ˆæœ¬çš„è¦†ç›–èŒƒå›´ï¼ŒHTTP...","head":[["meta",{"property":"og:url","content":"https://blog.shabbywu.cn/posts/2022/11/11/let-s-encrypt-%E5%AE%9E%E7%8E%B0%E5%85%A8%E8%87%AA%E5%8A%A8%E5%85%8D%E8%B4%B9-https-%E8%AF%81%E4%B9%A6%E6%89%98%E7%AE%A1-%E8%87%AA%E5%8A%A8%E7%AD%BE%E5%8F%91%E3%80%81%E7%BB%AD%E6%9C%9F.html"}],["meta",{"property":"og:site_name","content":"ä¸ªäººæŠ€æœ¯æ–‡ç« åˆ†äº«"}],["meta",{"property":"og:title","content":"Let's Encrypt - å®ç°å…¨è‡ªåŠ¨å…è´¹ HTTPS è¯ä¹¦æ‰˜ç®¡(è‡ªåŠ¨ç­¾å‘ã€ç»­æœŸ)"}],["meta",{"property":"og:description","content":"å‰è¨€ ä¸ºäº†æ¨åŠ¨æ›´å®‰å…¨çš„ HTTPS åŠ å¯†åè®®æ™®åŠå…¨ç½‘ï¼Œè°·æ­Œ Chrome æµè§ˆå™¨ä» 2017 å¹´å¼€å§‹é€æ­¥å¯¹HTTPç½‘ç«™æ ‡è®° â€œä¸å®‰å…¨â€ è­¦å‘Šï¼Œå¹¶åœ¨ 2018å¹´7æœˆ24æ—¥ å‘å¸ƒçš„ Chrome 68 æ­£å¼ç‰ˆæœ¬ä¸­å°†æ‰€æœ‰ HTTP ç½‘ç«™æ ‡è®° â€œä¸å®‰å…¨â€ã€‚ Chromeä¸å®‰å…¨æ¼”ç¤ºå›¾ç‰‡Chromeä¸å®‰å…¨æ¼”ç¤ºå›¾ç‰‡ éšç€ Chrome 68 ç‰ˆæœ¬çš„è¦†ç›–èŒƒå›´ï¼ŒHTTP..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://blog.shabbywu.cn/img/Chromeä¸å®‰å…¨æ¼”ç¤º.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-02-24T07:10:47.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:alt","content":"Let's Encrypt - å®ç°å…¨è‡ªåŠ¨å…è´¹ HTTPS è¯ä¹¦æ‰˜ç®¡(è‡ªåŠ¨ç­¾å‘ã€ç»­æœŸ)"}],["meta",{"property":"article:author","content":"shabbywu"}],["meta",{"property":"article:tag","content":"HTTPS"}],["meta",{"property":"article:tag","content":"Let's Encrypt"}],["meta",{"property":"article:tag","content":"è‡ªåŠ¨åŒ–"}],["meta",{"property":"article:published_time","content":"2022-11-11T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-02-24T07:10:47.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Let's Encrypt - å®ç°å…¨è‡ªåŠ¨å…è´¹ HTTPS è¯ä¹¦æ‰˜ç®¡(è‡ªåŠ¨ç­¾å‘ã€ç»­æœŸ)\\",\\"image\\":[\\"https://blog.shabbywu.cn/img/Chromeä¸å®‰å…¨æ¼”ç¤º.png\\",\\"https://blog.shabbywu.cn/img/Chromeä¸å®‰å…¨æ¼”ç¤º(çº¢è‰²\\"],\\"datePublished\\":\\"2022-11-11T00:00:00.000Z\\",\\"dateModified\\":\\"2024-02-24T07:10:47.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"shabbywu\\",\\"url\\":\\"https://github.com/shabbywu\\"}]}"],["link",{"rel":"alternate","type":"application/atom+xml","href":"https://blog.shabbywu.cn/atom.xml","title":"ä¸ªäººæŠ€æœ¯æ–‡ç« åˆ†äº« Atom Feed"}],["link",{"rel":"alternate","type":"application/json","href":"https://blog.shabbywu.cn/feed.json","title":"ä¸ªäººæŠ€æœ¯æ–‡ç« åˆ†äº« JSON Feed"}],["link",{"rel":"alternate","type":"application/rss+xml","href":"https://blog.shabbywu.cn/rss.xml","title":"ä¸ªäººæŠ€æœ¯æ–‡ç« åˆ†äº« RSS Feed"}]]},"headers":[{"level":2,"title":"å‰è¨€","slug":"å‰è¨€","link":"#å‰è¨€","children":[]},{"level":2,"title":"ä»€ä¹ˆæ˜¯ Let's Encrypt","slug":"ä»€ä¹ˆæ˜¯-let-s-encrypt","link":"#ä»€ä¹ˆæ˜¯-let-s-encrypt","children":[]},{"level":2,"title":"å¦‚ä½•ç”³è¯· Let's Encrypt è¯ä¹¦","slug":"å¦‚ä½•ç”³è¯·-let-s-encrypt-è¯ä¹¦","link":"#å¦‚ä½•ç”³è¯·-let-s-encrypt-è¯ä¹¦","children":[{"level":3,"title":"Let's Encrypt çš„å·¥ä½œåŸç†","slug":"let-s-encrypt-çš„å·¥ä½œåŸç†","link":"#let-s-encrypt-çš„å·¥ä½œåŸç†","children":[]},{"level":3,"title":"æµç¨‹æ¼”ç¤º","slug":"æµç¨‹æ¼”ç¤º","link":"#æµç¨‹æ¼”ç¤º","children":[]}]},{"level":2,"title":"å…¨è‡ªåŠ¨æ‰˜ç®¡ Let's Encrypt è¯ä¹¦","slug":"å…¨è‡ªåŠ¨æ‰˜ç®¡-let-s-encrypt-è¯ä¹¦","link":"#å…¨è‡ªåŠ¨æ‰˜ç®¡-let-s-encrypt-è¯ä¹¦","children":[{"level":3,"title":"å®šæ—¶ä»»åŠ¡ - linux cron","slug":"å®šæ—¶ä»»åŠ¡-linux-cron","link":"#å®šæ—¶ä»»åŠ¡-linux-cron","children":[]},{"level":3,"title":"ä½¿ç”¨é›†æˆ ACME çš„ç½‘å…³ - traefik","slug":"ä½¿ç”¨é›†æˆ-acme-çš„ç½‘å…³-traefik","link":"#ä½¿ç”¨é›†æˆ-acme-çš„ç½‘å…³-traefik","children":[]}]}],"readingTime":{"minutes":7.68,"words":2305},"filePathRelative":"_posts/sre/2022-11-11-let-s-encrypt-å®ç°å…¨è‡ªåŠ¨å…è´¹-https-è¯ä¹¦æ‰˜ç®¡-è‡ªåŠ¨ç­¾å‘ã€ç»­æœŸ.md","localizedDate":"2022å¹´11æœˆ11æ—¥","autoDesc":true,"git":{"createdTime":1708758647000,"updatedTime":1708758647000,"contributors":[{"name":"shabbywu","email":"shabbywu@tencent.com","commits":1}]}}`);export{D as comp,N as data};
